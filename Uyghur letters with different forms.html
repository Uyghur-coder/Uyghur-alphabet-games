<!DOCTYPE html>
<html lang="ug" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Uyghur Letter Forms Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Load Alkatip Yazma font -->
  <style>
  @font-face {
    font-family: 'AlkatipYazma';
    src: url('https://Uyghur-coder.github.io/Uyghur-alphabet-games/fonts/ALKATIPYazma.ttf') format('truetype');
  }
  .uyghur { font-family: 'AlkatipYazma', sans-serif; font-size: 2rem; }
  .slot, .option {
    border: 2px dashed #ccc;
    min-height: 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 0.5rem;
    transition: all 0.2s;
  }
  .option.selected { border-color: #2563eb; background-color: #dbeafe; color: #1d4ed8; font-weight: bold; }
  .slot.locked { color: #16a34a; font-weight: bold; }
  .shake { animation: shake 0.4s; }
  @keyframes shake {0%,100%{ transform: translateX(0); } 20%,60%{ transform: translateX(-6px); } 40%,80%{ transform: translateX(6px); }}
  .glow { animation: pulseGlow 1.5s infinite; }
  @keyframes pulseGlow {0% { text-shadow: 0 0 5px orange,0 0 10px gold; } 50% { text-shadow: 0 0 15px red,0 0 30px gold; } 100% { text-shadow: 0 0 5px orange,0 0 10px gold; }}
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-6">
  <h1 class="text-2xl font-bold mb-2">Uyghur Alphabet Forms Game</h1>
  <p id="score" class="text-lg font-semibold mb-2">Score: 0 / 0</p>
  <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
    <div id="progressBar" class="h-4 rounded-full bg-green-500" style="width:0%"></div>
  </div>
  <p id="streak" class="text-lg font-semibold text-orange-600 mb-4">Streak: 0 🔥</p>

  <div id="gameBox" class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-2xl text-center">
    <p class="mb-4">Drag a letter form to the correct slot (<b>initial</b>, <b>medial</b>, <b>final</b>).</p>
    <div id="question" class="mb-6">
      <span id="letter" class="uyghur text-5xl"></span>
      <span id="latin" class="ml-4 text-xl text-gray-600"></span>
    </div>

    <div class="grid grid-cols-3 gap-4 mb-6">
      <div>
        <label class="block mb-1">Initial</label>
        <div id="initialSlot" class="slot"></div>
      </div>
      <div>
        <label class="block mb-1">Medial</label>
        <div id="medialSlot" class="slot"></div>
      </div>
      <div>
        <label class="block mb-1">Final</label>
        <div id="finalSlot" class="slot"></div>
      </div>
    </div>

    <div id="options" class="flex flex-wrap gap-2 justify-center mb-6"></div>

    <div class="flex justify-center gap-4 mb-4">
      <button onclick="checkAnswer()" class="bg-blue-500 text-white px-6 py-2 rounded-xl shadow hover:bg-blue-600">Check</button>
      <button onclick="newQuestion()" class="bg-gray-500 text-white px-6 py-2 rounded-xl shadow hover:bg-gray-600">New Round</button>
      <button onclick="clearSlots()" class="bg-yellow-500 text-white px-6 py-2 rounded-xl shadow hover:bg-yellow-600">Clear</button>
    </div>
    <p id="feedback" class="mt-4 font-semibold"></p>
  </div>

  <script>
    const letters = [
      { isolated: ['ئا','ا'], latin: 'a', initial: [], medial: [], final: ['ـا','ـئا'] },
      { isolated: ['ئە','ە'], latin: 'e', initial: [], medial: [], final: ['ـە','ـئە'] },
      { isolated: ['ب'], latin: 'b', initial: ['بـ'], medial: ['ـبـ'], final: ['ـب'] },
      { isolated: ['پ'], latin: 'p', initial: ['پـ'], medial: ['ـپـ'], final: ['ـپ'] },
      { isolated: ['ت'], latin: 't', initial: ['تـ'], medial: ['ـتـ'], final: ['ـت'] },
      { isolated: ['ج'], latin: 'j', initial: ['جـ'], medial: ['ـجـ'], final: ['ـج'] },
      { isolated: ['چ'], latin: 'ch', initial: ['چـ'], medial: ['ـچـ'], final: ['ـچ'] },
      { isolated: ['خ'], latin: 'kh', initial: ['خـ'], medial: ['ـخـ'], final: ['ـخ'] },
      { isolated: ['د'], latin: 'd', initial: [], medial: [], final: ['ـد'] },
      { isolated: ['ر'], latin: 'r', initial: [], medial: [], final: ['ـر'] },
      { isolated: ['ز'], latin: 'z', initial: [], medial: [], final: ['ـز'] },
      { isolated: ['ژ'], latin: 'zh', initial: [], medial: [], final: ['ـژ'] },
      { isolated: ['س'], latin: 's', initial: ['سـ'], medial: ['ـسـ'], final: ['ـس'] },
      { isolated: ['ش'], latin: 'sh', initial: ['شـ'], medial: ['ـشـ'], final: ['ـش'] },
      { isolated: ['غ'], latin: 'gh', initial: ['غـ'], medial: ['ـغـ'], final: ['ـغ'] },
      { isolated: ['ف'], latin: 'f', initial: ['فـ'], medial: ['ـفـ'], final: ['ـف'] },
      { isolated: ['ق'], latin: 'q', initial: ['قـ'], medial: ['ـقـ'], final: ['ـق'] },
      { isolated: ['ك'], latin: 'k', initial: ['كـ'], medial: ['ـكـ'], final: ['ـك'] },
      { isolated: ['گ'], latin: 'g', initial: ['گـ'], medial: ['ـگـ'], final: ['ـگ'] },
      { isolated: ['ڭ'], latin: 'ng', initial: ['ڭـ'], medial: ['ـڭـ'], final: ['ـڭ'] },
      { isolated: ['ل'], latin: 'l', initial: ['لـ'], medial: ['ـلـ'], final: ['ـل'] },
      { isolated: ['م'], latin: 'm', initial: ['مـ'], medial: ['ـمـ'], final: ['ـم'] },
      { isolated: ['ن'], latin: 'n', initial: ['نـ'], medial: ['ـنـ'], final: ['ـن'] },
      { isolated: ['ھ'], latin: 'h', initial: ['ھـ'], medial: ['ـھـ'], final: ['ـھ'] },
      { isolated: ['ئو','و'], latin: 'o', initial: [], medial: [], final: ['ـو','ـئو'] },
      { isolated: ['ئۇ','ۇ'], latin: 'u', initial: [], medial: [], final: ['ـۇ','ـئۇ'] },
      { isolated: ['ئۆ','ۆ'], latin: 'ö', initial: [], medial: [], final: ['ـۆ','ـئۆ'] },
      { isolated: ['ئۈ','ۈ'], latin: 'ü', initial: [], medial: [], final: ['ـۈ','ـئۈ'] },
      { isolated: ['ۋ'], latin: 'w', initial: [], medial: [], final: ['ـۋ'] },
      { isolated: ['ي'], latin: 'y', initial: ['يـ'], medial: ['ـيـ'], final: ['ـي'] },
      { isolated: ['ئې','ې'], latin: 'é', initial: ['ئېـ','ېـ'], medial: ['ـئېـ','ـېـ'], final: ['ـې'] },
      { isolated: ['ئى','ى'], latin: 'i', initial: ['ئىـ','ىـ'], medial: ['ـئىـ','ـىـ'], final: ['ـى'] }
    ];

    let current, correctRounds=0, totalRounds=0, streak=0;

    function shuffle(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]];} return array; }

    function newQuestion(){
      current = letters[Math.floor(Math.random()*letters.length)];
      document.getElementById("letter").textContent = current.isolated[0];
      document.getElementById("latin").textContent = `(${current.latin})`;
      clearSlots();
      document.getElementById("feedback").textContent='';

      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML='';

      const allForms = ['initial','medial','final'].flatMap(pos=>current[pos]);
      let distractors = letters.flatMap(l=>['initial','medial','final'].flatMap(pos=>l[pos])).filter(f=>f && !allForms.includes(f));
      let optionsList = shuffle(allForms.concat(distractors.slice(0,6)));

      optionsList.forEach(letter=>{
        const btn = document.createElement("div");
        btn.textContent = letter;
        btn.className = "option uyghur px-4 py-2 border rounded-lg bg-gray-100";
        btn.setAttribute("draggable", true);
        btn.addEventListener("dragstart", e => e.dataTransfer.setData("text/plain", letter));
        optionsDiv.appendChild(btn);
      });

      ['initial','medial','final'].forEach(pos=>{
        const slot=document.getElementById(pos+'Slot');
        slot.parentElement.style.display=current[pos].length?'block':'none';
      });

      updateScore();
    }

    function clearSlots(){
      document.querySelectorAll('.slot').forEach(s=>s.textContent='');
      document.getElementById("options").querySelectorAll(".option").forEach(o=>o.classList.remove("selected"));
    }

    // Make slots droppable
    document.querySelectorAll(".slot").forEach(slot=>{
      slot.addEventListener("dragover", e=>e.preventDefault());
      slot.addEventListener("drop", e=>{
        e.preventDefault();
        const letter = e.dataTransfer.getData("text/plain");
        let existing = slot.textContent.split(",").map(s=>s.trim()).filter(s=>s);
        if(!existing.includes(letter)) existing.push(letter);
        slot.textContent = existing.join(",");
        slot.classList.add("filled");

        // Remove from options
        document.querySelectorAll(".option").forEach(o=>{ if(o.textContent===letter) o.remove(); });
      });
    });

    // Drag letters back to options
    const optionsDiv = document.getElementById("options");
    optionsDiv.addEventListener("dragover", e=>e.preventDefault());
    optionsDiv.addEventListener("drop", e=>{
      e.preventDefault();
      const letter = e.dataTransfer.getData("text/plain");
      const btn = document.createElement("div");
      btn.textContent = letter;
      btn.className = "option uyghur px-4 py-2 border rounded-lg bg-gray-100";
      btn.setAttribute("draggable", true);
      btn.addEventListener("dragstart", e => e.dataTransfer.setData("text/plain", letter));
      optionsDiv.appendChild(btn);
    });

    function checkAnswer(){
      let allCorrect = true;
      ['initial','medial','final'].forEach(pos=>{
        const slot=document.getElementById(pos+'Slot');
        if(slot.parentElement.style.display==='none') return;

        const placed = slot.textContent.split(',').map(s=>s.trim()).filter(s=>s);
        const correct = current[pos];

        let wrongLetters = [], correctInSlot=[];
        placed.forEach(letter=>{
          if(correct.includes(letter)) correctInSlot.push(letter);
          else wrongLetters.push(letter);
        });

        slot.textContent=correctInSlot.join(',');
        if(correctInSlot.length===correct.length && wrongLetters.length===0){
          slot.classList.add("correct","locked");
        } else {
          slot.classList.add("shake","wrong");
          setTimeout(()=>slot.classList.remove("shake","wrong"),500);
          allCorrect=false;
        }

        // Return wrong letters to options
        wrongLetters.forEach(letter=>{
          if(!Array.from(optionsDiv.children).some(o=>o.textContent===letter)){
            const btn=document.createElement("div");
            btn.textContent=letter;
            btn.className="option uyghur px-4 py-2 border rounded-lg bg-gray-100";
            btn.setAttribute("draggable", true);
            btn.addEventListener("dragstart", e=>e.dataTransfer.setData("text/plain", letter));
            optionsDiv.appendChild(btn);
          }
        });
      });

      const feedback = document.getElementById("feedback");
      if(allCorrect){
        correctRounds++;
        streak++;
        feedback.textContent="✅ Correct!";
        feedback.className="mt-4 font-semibold text-green-600";
        setTimeout(newQuestion,1500);
      } else {
        streak=0;
        feedback.textContent="❌ Some letters are wrong, try again!";
        feedback.className="mt-4 font-semibold text-red-600";
      }
      totalRounds++;
      updateScore();
    }

    function updateScore(){
      document.getElementById("score").textContent=`Score: ${correctRounds} / ${totalRounds}`;
      const progress = totalRounds>0?Math.round((correctRounds/totalRounds)*100):0;
      const bar = document.getElementById("progressBar");
      bar.style.width = progress+"%";
      bar.className = progress>=80?"h-4 rounded-full bg-green-500":progress>=50?"h-4 rounded-full bg-yellow-500":"h-4 rounded-full bg-red-500";

      const streakEl=document.getElementById("streak");
      if(streak>0){ streakEl.textContent=`Streak: ${streak} 🔥`; streakEl.classList.add("glow"); }
      else{ streakEl.textContent="Streak: 0"; streakEl.classList.remove("glow"); }
    }

    newQuestion();
  </script>
</body>
</html>
